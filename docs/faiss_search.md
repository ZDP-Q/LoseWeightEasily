# 🚀 FAISS 向量语义搜索技术文档

## 📋 系统概述

本系统使用 **FAISS 向量语义搜索** 技术实现智能食物查询，支持中英文跨语言搜索。

## 🔍 技术原理

### 1. 向量嵌入（Embedding）

使用 `SentenceTransformer` 模型将文本转换为高维向量：

```python
# 模型: paraphrase-multilingual-MiniLM-L12-v2
# 特点: 支持 100+ 语言，包括中文和英文

"番茄" → [0.23, -0.41, 0.18, ..., 0.56]  # 384维向量
"tomato" → [0.24, -0.39, 0.19, ..., 0.54] # 语义相似的向量接近
```

### 2. FAISS 索引

使用 Facebook AI 的 FAISS 库进行高效向量搜索：

```python
# 索引类型: IndexFlatIP (内积/余弦相似度)
# 操作: 
#   1. 将所有食物描述转换为向量
#   2. 构建索引（一次性，保存到磁盘）
#   3. 查询时快速找到最相似的向量
```

### 3. 语义匹配流程

```
用户输入 "番茄"
    ↓
[步骤1] 转换为向量
    query_vector = model.encode("番茄")
    ↓
[步骤2] 在 FAISS 索引中搜索
    找到余弦相似度最高的 top-k 个食物
    ↓
[步骤3] 返回结果
    1. Tomatoes, grape, raw (相似度: 0.85)
    2. Tomatoes, canned... (相似度: 0.82)
    ...
```

## ✨ 核心优势

### vs 传统字典映射方案

| 特性 | 字典方案 | FAISS 向量方案 |
|------|---------|---------------|
| 维护成本 | ❌ 需要手动维护词典 | ✅ 自动理解语义 |
| 同义词支持 | ❌ 必须全部列出 | ✅ 自动识别（番茄=西红柿） |
| 描述性查询 | ❌ 不支持 | ✅ 支持（"坚果"→各种nuts） |
| 容错能力 | ⚠️ 仅字符串匹配 | ✅ 语义级别理解 |
| 跨语言 | ❌ 需要翻译 | ✅ 自动跨语言匹配 |
| 扩展性 | ❌ 添加新词需要编码 | ✅ 无需修改代码 |

### 实际效果示例

```python
# 1. 自动识别同义词
"番茄" → Tomatoes...    # ✅ 匹配
"西红柿" → Tomatoes...  # ✅ 匹配（无需词典）

# 2. 理解描述性查询
"坚果" → Almonds, Walnuts, Peanuts...  # ✅ 找到所有坚果

# 3. 跨语言语义理解
"牛肉香肠" → Beef frankfurter...  # ✅ 理解复合词

# 4. 容错和近似匹配
"almund"（拼写错误）→ Almond...  # ✅ 语义相似

# 5. 中英文混合
"beef 牛肉" → Beef products...  # ✅ 理解混合输入
```

## 🛠️ 技术实现

### 依赖库

- `faiss-cpu` - 向量索引和搜索
- `sentence-transformers` - 文本嵌入模型
- `numpy` - 数值计算

### 文件说明

| 文件 | 说明 |
|------|------|
| `food_index.faiss` | FAISS 向量索引（自动生成） |
| `food_metadata.pkl` | 食物元数据（自动生成） |

### 模型信息

- **名称**: paraphrase-multilingual-MiniLM-L12-v2
- **维度**: 384 维向量
- **语言**: 支持中文、英文等 100+ 语言
- **大小**: 约 420MB（首次下载）
- **来源**: HuggingFace Model Hub

## 📊 性能特点

### 构建索引

- 时间: 365 个食物约 30-60 秒
- 空间: 索引文件约 500KB

### 查询性能

- 单次查询: < 100ms
- 支持批量查询

## 🔧 配置选项

通过环境变量配置：

| 环境变量 | 默认值 | 说明 |
|---------|--------|------|
| `LOSS_DB_PATH` | `food_data.db` | 数据库路径 |
| `LOSS_EMBEDDING_MODEL` | `paraphrase-multilingual-MiniLM-L12-v2` | 嵌入模型 |
| `LOSS_SEARCH_LIMIT` | `10` | 默认搜索结果数 |
| `LOSS_SIMILARITY_THRESHOLD` | `0.3` | 相似度阈值 |
